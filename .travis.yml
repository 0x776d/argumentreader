# Travis CI for building ArgumentReader
# -------------------------------------

language: csharp
solution: ArgumentsExtended.sln
mono: none
dotnet: 3.1.301

addons:
 apt:
   packages:
     - zip

install:
  - dotnet restore

script:
  - dotnet build -c Release -o ./latest
  - dotnet test
  - ls -l ./latest

before_deploy:
  - export TRAVIS_TAG="latest"
  - git tag $TRAVIS_TAG --force
  - find ./latest -name "*Lib.dll" -maxdepth 1 | zip -@ latest.zip

deploy:
  provider: releases
  overwrite: true
  api_key: $GITHUB_TOKEN
  file:
    - "./latest.zip"
    - "./latest/*"
    - "./latest/ArgumentMarshalerLib.dll"
    - "./latest/ArgumentsLib.dll"
    - "./latest/BooleanMarshalerLib.dll"
    - "./latest/IntegerMarshalerLib.dll"
    - "./latest/StringMarshalerLib.dll"
  skip_cleanup: true
  keep_history: true
  on:
    branch: master
